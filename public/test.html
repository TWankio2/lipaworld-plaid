<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plaid Microservice Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .quick-test {
            padding: 20px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            text-align: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin: 5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .test-area {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
        }

        textarea.form-control {
            height: 120px;
            font-family: 'Monaco', 'Consolas', monospace;
        }

        .response-box {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 20px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .status-200 { background: #10b981; color: white; }
        .status-400 { background: #f59e0b; color: white; }
        .status-500 { background: #dc2626; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¶ Plaid Microservice Test</h1>
            <p>Simple API Testing Interface</p>
        </div>

        <div class="quick-test">
            <h3>üöÄ Quick Tests</h3>
            <button class="btn btn-primary" onclick="testHealth()">Health Check</button>
            <button class="btn btn-primary" onclick="testLinkToken()">Create Link Token</button>
        </div>

        <div class="test-area">
            <div class="form-group">
                <label>üîê API Key:</label>
                <input type="text" id="apiKey" class="form-control" 
                       value="1aef789a9e16972b2c75729cbe6972eb129a09b62d4df900f207b8257ccbc702">
            </div>

            <div class="form-group">
                <label>üìù Custom Request Body (JSON):</label>
                <textarea id="requestBody" class="form-control">{
  "user_id": "user_12345",
  "client_name": "Test App",
  "country_codes": ["US"],
  "language": "en",
  "products": ["transactions", "identity"]
}</textarea>
            </div>

            <div class="form-group">
                <label>üéØ Endpoint:</label>
                <select id="endpoint" class="form-control">
                    <option value="GET:/health">GET /health (Health Check)</option>
                    <option value="POST:/link-token">POST /link-token (Create Link Token)</option>
                    <option value="POST:/exchange-token">POST /exchange-token (Exchange Token)</option>
                    <option value="POST:/accounts">POST /accounts (Get Accounts)</option>
                    <option value="POST:/transactions">POST /transactions (Get Transactions)</option>
                    <option value="POST:/identity">POST /identity (Get Identity)</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="sendCustomRequest()">Send Custom Request</button>
            <button class="btn" onclick="clearResponse()" style="background: #6b7280; color: white;">Clear Response</button>

            <div id="response-status"></div>
            <div id="response-content" class="response-box">
üéØ Welcome to the Plaid Microservice Test Interface!

Try these quick tests:
1. Click "Health Check" to verify the service is running
2. Click "Create Link Token" to test the core Plaid functionality
3. Use the custom request form below for other endpoints

Response will appear here...
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';

        async function testHealth() {
            await makeRequest('GET', '/health');
        }

        async function testLinkToken() {
            const body = {
                "user_id": "test_user_123",
                "client_name": "Test App",
                "country_codes": ["US"],
                "language": "en",
                "products": ["transactions", "identity"]
            };
            await makeRequest('POST', '/link-token', body);
        }

        async function sendCustomRequest() {
            const endpoint = document.getElementById('endpoint').value;
            const [method, path] = endpoint.split(':');
            
            let body = null;
            if (method === 'POST') {
                try {
                    body = JSON.parse(document.getElementById('requestBody').value);
                } catch (e) {
                    showError('Invalid JSON in request body: ' + e.message);
                    return;
                }
            }
            
            await makeRequest(method, path, body);
        }

        async function makeRequest(method, endpoint, body = null) {
            const apiKey = document.getElementById('apiKey').value;
            const responseStatus = document.getElementById('response-status');
            const responseContent = document.getElementById('response-content');

            responseContent.textContent = 'Sending request...';
            responseStatus.innerHTML = '';

            try {
                const headers = {
                    'Content-Type': 'application/json'
                };

                if (apiKey && endpoint !== '/health') {
                    headers['X-API-Key'] = apiKey;
                }

                const requestOptions = {
                    method: method,
                    headers: headers
                };

                if (method === 'POST' && body) {
                    requestOptions.body = JSON.stringify(body);
                }

                console.log('Making request to:', API_BASE + endpoint);
                console.log('Request options:', requestOptions);

                const response = await fetch(API_BASE + endpoint, requestOptions);
                const data = await response.json();

                const statusClass = response.ok ? 'status-200' : 
                    response.status >= 400 && response.status < 500 ? 'status-400' : 'status-500';
                
                responseStatus.innerHTML = `<span class="status-badge ${statusClass}">${response.status} ${response.statusText}</span>`;
                responseContent.textContent = JSON.stringify(data, null, 2);

            } catch (error) {
                showError('Request failed: ' + error.message);
            }
        }

        function showError(message) {
            document.getElementById('response-status').innerHTML = '<span class="status-badge status-500">ERROR</span>';
            document.getElementById('response-content').textContent = message + `

Common issues:
- Make sure the service is running on port 3000
- Check the browser console for CORS errors
- Verify the API key is correct
- Ensure the request body is valid JSON`;
        }

        function clearResponse() {
            document.getElementById('response-status').innerHTML = '';
            document.getElementById('response-content').textContent = 'Response cleared. Send a request to see results here.';
        }

        // Update request body based on selected endpoint
        document.getElementById('endpoint').addEventListener('change', function() {
            const endpoint = this.value;
            const requestBody = document.getElementById('requestBody');
            
            if (endpoint.includes('/link-token')) {
                requestBody.value = JSON.stringify({
                    "user_id": "user_12345",
                    "client_name": "Test App",
                    "country_codes": ["US"],
                    "language": "en",
                    "products": ["transactions", "identity"]
                }, null, 2);
            } else if (endpoint.includes('/exchange-token')) {
                requestBody.value = JSON.stringify({
                    "public_token": "public-sandbox-abc123-def456",
                    "user_id": "user_12345"
                }, null, 2);
            } else if (endpoint.includes('/accounts') || endpoint.includes('/transactions') || endpoint.includes('/identity')) {
                requestBody.value = JSON.stringify({
                    "access_token": "access-sandbox-xyz789-abc123"
                }, null, 2);
            }
        });
    </script>
</body>
</html>